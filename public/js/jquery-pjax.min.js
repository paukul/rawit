(function(b){b.fn.pjax=function(a,c){c?c.container=a:c=b.isPlainObject(a)?a:{container:a};if(c.container&&typeof c.container!=="string")throw"pjax container must be a string selector!";return this.live("click",function(a){if(a.which>1||a.metaKey)return true;var d={url:this.href,container:b(this).attr("data-pjax"),clickedElement:b(this),fragment:null};b.pjax(b.extend({},d,c));a.preventDefault()})};var d=b.pjax=function(a){var c=b(a.container),h=a.success||b.noop;delete a.success;if(typeof a.container!==
"string")throw"pjax container must be a string selector!";a=b.extend(true,{},d.defaults,a);if(b.isFunction(a.url))a.url=a.url();a.context=c;a.success=function(c){if(a.fragment){var e=b(c).find(a.fragment);if(e.length)c=e.children();else return window.location=a.url}else if(!b.trim(c)||/<html/i.test(c))return window.location=a.url;this.html(c);var g=document.title,f=b.trim(this.find("title").remove().text());if(f)document.title=f;!f&&a.fragment&&(e.attr("title")||e.data("title"));e={pjax:a.container,
fragment:a.fragment,timeout:a.timeout};f=b.param(a.data);if(f!="_pjax=true")e.url=a.url+(/\?/.test(a.url)?"&":"?")+f;if(a.replace)window.history.replaceState(e,document.title,a.url);else if(a.push){if(!d.active)window.history.replaceState(b.extend({},e,{url:null}),g),d.active=true;window.history.pushState(e,document.title,a.url)}(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);g=window.location.hash.toString();if(g!=="")window.location.href=g;h.apply(this,arguments)};if((c=d.xhr)&&
c.readyState<4)c.onreadystatechange=b.noop,c.abort();d.options=a;d.xhr=b.ajax(a);b(document).trigger("pjax",[d.xhr,a]);return d.xhr};d.defaults={timeout:650,push:true,replace:false,data:{_pjax:true},type:"GET",dataType:"html",beforeSend:function(a){this.trigger("pjax:start",[a,d.options]);this.trigger("start.pjax",[a,d.options]);a.setRequestHeader("X-PJAX","true")},error:function(a,b){if(b!=="abort")window.location=d.options.url},complete:function(a){this.trigger("pjax:end",[a,d.options]);this.trigger("end.pjax",
[a,d.options])}};var h="state"in window.history,i=location.href;b(window).bind("popstate",function(a){var c=!h&&location.href==i;h=true;if(!c&&(a=a.state)&&a.pjax)c=a.pjax,b(c+"").length?b.pjax({url:a.url||location.href,fragment:a.fragment,container:c,push:false,timeout:a.timeout}):window.location=location.href});b.inArray("state",b.event.props)<0&&b.event.props.push("state");b.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/(iPod|iPhone|iPad|WebApps\/.+CFNetwork)/);
if(!b.support.pjax)b.pjax=function(a){window.location=b.isFunction(a.url)?a.url():a.url},b.fn.pjax=function(){return this}})(jQuery);
